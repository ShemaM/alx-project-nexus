{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block content %}
<style>
  .metric-fill {
    width: 0%;
  }
  .metric-fill-verified {
    background: #2d8fdd;
  }
  .metric-fill-active {
    background: #d52b2b;
  }
  .metric-fill-coverage {
    background: #f5d300;
  }
</style>
<div class="max-w-7xl mx-auto py-4 md:py-6">
  <div class="rounded-2xl border border-slate-200 bg-white shadow-lg overflow-hidden">
    <div class="px-6 md:px-8 py-6 text-white" style="background:linear-gradient(120deg,#1E3A5F 0%,#2D8FDD 70%,#D52B2B 100%);">
      <div class="flex items-center gap-4">
        <img src="{% static 'admin/images/logo.png' %}" alt="BYN-K logo" class="h-14 w-14 rounded-xl border-2 border-white/40 bg-white object-cover">
        <div>
          <p class="text-xs uppercase tracking-wider text-blue-100 font-semibold">Platform Management</p>
          <h2 class="text-2xl md:text-3xl font-black leading-tight">{{ admin_greeting|default:"Welcome to BYN-K Admin." }}</h2>
          <p class="mt-1 text-blue-100">Manage opportunities, track performance, and monitor system health.</p>
        </div>
      </div>
    </div>
    <div class="h-1.5" style="background:linear-gradient(90deg,#F5D300 0%,#2D8FDD 60%,#D52B2B 100%);"></div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mt-5">
    <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
      <p class="text-xs uppercase tracking-wide text-slate-500">Total Opportunities</p>
      <p class="text-3xl font-black text-slate-900 mt-1">{{ admin_metrics.total_jobs|default:0 }}</p>
      <p class="text-xs text-slate-500 mt-1">{{ admin_metrics.created_today|default:0 }} created today</p>
    </div>
    <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
      <p class="text-xs uppercase tracking-wide text-slate-500">Verified Opportunities</p>
      <p class="text-3xl font-black text-slate-900 mt-1">{{ admin_metrics.verified_jobs|default:0 }}</p>
      <p class="text-xs text-slate-500 mt-1">{{ admin_metrics.active_jobs|default:0 }} currently active</p>
    </div>
    <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
      <p class="text-xs uppercase tracking-wide text-slate-500">Update Subscribers</p>
      <p class="text-3xl font-black text-slate-900 mt-1">{{ admin_metrics.active_subscribers|default:0 }}</p>
      <p class="text-xs text-slate-500 mt-1">Signed up for notifications</p>
    </div>
    <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
      <p class="text-xs uppercase tracking-wide text-slate-500">Total Engagement</p>
      <p class="text-3xl font-black text-slate-900 mt-1">{{ admin_metrics.total_clicks|default:0 }}</p>
      <p class="text-xs text-slate-500 mt-1">Apply/details/brochure clicks</p>
    </div>
  </div>

  <div class="grid grid-cols-1 xl:grid-cols-3 gap-5 mt-5">
    <section class="xl:col-span-2 rounded-xl border border-slate-200 bg-white p-5 shadow-sm">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-lg font-bold text-slate-900">Latest Opportunities Created</h3>
        <a href="/admin/listings/job/" class="text-sm font-semibold" style="color:#1E6BB8;">View all</a>
      </div>
      {% if admin_latest_jobs %}
      <ul class="space-y-3">{% for job in admin_latest_jobs %}<li class="rounded-lg border border-slate-100 p-3 hover:bg-slate-50 transition-colors"><div class="flex items-start justify-between gap-3"><div><p class="font-semibold text-slate-900">{{ job.title }}</p><p class="text-sm text-slate-600">{{ job.organization_name }}</p></div><a href="/admin/listings/job/{{ job.id }}/change/" class="text-xs font-semibold" style="color:#1E6BB8;">Open</a></div></li>{% endfor %}</ul>
      {% else %}
      <p class="text-slate-600">No opportunities yet.</p>
      {% endif %}
    </section>

    <section class="rounded-xl border border-slate-200 bg-white p-5 shadow-sm">
      <h3 class="text-lg font-bold text-slate-900 mb-4">System Health</h3>
      <div class="space-y-3 text-sm">
        <div class="flex items-center justify-between">
          <span class="text-slate-600">Database</span>
          <span class="font-semibold {% if admin_system_health.database == 'Healthy' %}text-emerald-600{% else %}text-amber-600{% endif %}">
            {{ admin_system_health.database|default:"Unknown" }}
          </span>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-slate-600">Timezone</span>
          <span class="font-semibold text-slate-900">{{ admin_system_health.timezone|default:"Africa/Nairobi" }}</span>
        </div>
        <div class="flex items-center justify-between">
          <span class="text-slate-600">Debug Mode</span>
          <span class="font-semibold {% if admin_system_health.debug_mode == 'On' %}text-amber-600{% else %}text-emerald-600{% endif %}">
            {{ admin_system_health.debug_mode|default:"Off" }}
          </span>
        </div>
      </div>

      <div class="mt-5 rounded-lg border border-slate-100 bg-slate-50 p-3">
        <p class="text-xs uppercase tracking-wide text-slate-500 mb-2">Data Representation</p>
        <div class="space-y-2">
          <div>
            <div class="flex items-center justify-between text-xs text-slate-600">
              <span>Verified / Total</span>
              <span>{{ admin_metrics.verified_jobs|default:0 }} / {{ admin_metrics.total_jobs|default:0 }}</span>
            </div>
            <div class="h-2 rounded-full bg-slate-200 mt-1 overflow-hidden">
              <div class="h-full metric-fill metric-fill-verified" data-width="{{ width_verified|default:'0' }}"></div>
            </div>
          </div>
          <div>
            <div class="flex items-center justify-between text-xs text-slate-600">
              <span>Active / Total</span>
              <span>{{ admin_metrics.active_jobs|default:0 }} / {{ admin_metrics.total_jobs|default:0 }}</span>
            </div>
            <div class="h-2 rounded-full bg-slate-200 mt-1 overflow-hidden">
              <div class="h-full metric-fill metric-fill-active" data-width="{{ width_active|default:'0' }}"></div>
            </div>
          </div>
          <div>
            <div class="flex items-center justify-between text-xs text-slate-600">
              <span>Coverage Accent</span>
              <span>{{ admin_metrics.total_jobs|default:0 }} total</span>
            </div>
            <div class="h-2 rounded-full bg-slate-200 mt-1 overflow-hidden">
              <div class="h-full metric-fill metric-fill-coverage" data-width="{{ width_coverage|default:'0' }}"></div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <div class="mt-5 rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
    <h3 class="text-base font-bold text-slate-900 mb-3">{% translate "Quick Access" %}</h3>
    <div class="flex flex-wrap gap-2">
      <a class="inline-flex items-center rounded-lg border border-slate-200 px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50" href="/admin/listings/job/add/">Create Opportunity</a>
      <a class="inline-flex items-center rounded-lg border border-slate-200 px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50" href="/admin/users/signedupuser/">Signed Up Users</a>
      <a class="inline-flex items-center rounded-lg border border-slate-200 px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50" href="/admin/users/updatesubscriber/">Update Subscribers</a>
      <a class="inline-flex items-center rounded-lg border border-slate-200 px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-50" href="/admin/listings/clickanalytics/">View Analytics</a>
    </div>
  </div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.metric-fill[data-width]').forEach(function (el) {
      var parsed = Number.parseFloat(el.dataset.width);
      var width = Number.isFinite(parsed) ? Math.max(0, Math.min(100, parsed)) : 0;
      el.style.width = width + '%';
    });
  });
</script>
{% endblock %}
